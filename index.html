<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Report Automation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react-markdown": "https://aistudiocdn.com/react-markdown@^10.1.0"
  }
}
</script>

    <style>
      body { background-color: #0f172a; color: #f1f5f9; }
      .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
      .gradient-text { background: linear-gradient(to right, #818cf8, #c084fc); -webkit-background-clip: text; color: transparent; }
      .bookmark-btn { cursor: grab; }
      .bookmark-btn:active { cursor: grabbing; }
    </style>
  <link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState } from 'react';
      import ReactDOM from 'react-dom/client';
      import { Download, Globe, ShieldCheck, ExternalLink, MousePointerClick, LayoutGrid, ArrowRight } from 'lucide-react';

      // --- TECHONLINE LOGIC GENERATOR ---
      const generateTechOnlineScript = (config) => {
        const script = `
(function() {
  console.log("Starting TechOnline Export...");
  
  // 1. DATE HELPERS
  function formatDate(d, isEnd) {
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    const t = isEnd ? '23:59:59' : '00:00:00';
    return {
      date: y + '-' + m + '-' + dd,
      datetime: y + '-' + m + '-' + dd + ' ' + t
    };
  }

  // 2. CALCULATE RANGE
  const today = new Date();
  const day = today.getDay();
  let start, end, label;

  if (day === 1) { // Monday -> Get Fri, Sat, Sun
    const fri = new Date(today); fri.setDate(today.getDate() - 3);
    const sun = new Date(today); sun.setDate(today.getDate() - 1);
    start = fri;
    end = sun;
    label = "Weekend (Fri-Sun)";
  } else { // Daily -> Get Yesterday
    const yest = new Date(today); yest.setDate(today.getDate() - 1);
    start = yest;
    end = yest;
    label = "Daily (Yesterday)";
  }

  // 3. DEFINE REPORTS
  const reports = [
    {
      name: 'Bonus Stats',
      reportId: 'Reporting___Bonus_statistics',
      code: '477053',
      outputs: 'currency_code,username,userid,instance_name,viplevel,bonus_template_name,bonus_type_name,fillrealbalance,fillbonusbalance,fillpendingwinnings,bonus_status,product,game_name,accepted,accepted_fs,bonus_bet_cancel,bonus_bet,bonus_pending_winnings_bet,bonus_pending_winnings_cancel,bonus_pending_winnings_win,bonus_win,cancelled_bonus_initial,cancelled_bonus_initial_fs,cancelled_pending_winnings,cancelled_used_bonus_initial,expired_bonus_initial,expired_bonus_initial_fs,expired_pending_winnings,bonus_bet_fs,player_count,redeemed_bonus_initial,redeemed_bonus_initial_fs,redeemed_pending_winnings,reverse_redeemed_bonus_initial,used_bonus_initial',
      getFilters: (s, e) => ({
        instance: ${JSON.stringify(config.instances)},
        daterange: JSON.stringify({ startdate: formatDate(s).datetime, enddate: formatDate(e, true).datetime }),
        time_zone_picker: '${config.timeZone}',
        reportBy: 'username,userid,instance,viplevel,bonus_template_name,bonus_type_name,fillrealbalance,fillbonusbalance,fillpendingwinnings,bonus_status,product,game_name'
      })
    },
    {
      name: 'Game Stats',
      reportId: 'Reporting___Game_statistics',
      code: '466541',
      outputs: 'currencycode,username,playercode,casino,date1,clienttype,clientplatform,viplevel,platform,gamename,maximumrtp,gametype,gtype,gamegroup,gameshortname,gameprovider,gametechnology,gamesuite,gamescnt,totalbets,totalgamebets,totalgamewins,totalincome,refund,totalplayerwins,realbets,realmoneyincome',
      getFilters: (s, e) => ({
        sdin: '2',
        siaccounts: '2',
        casino: ${JSON.stringify(config.instances)},
        daterange: JSON.stringify({ startdate: formatDate(s).date, enddate: formatDate(e, true).date }),
        reportBy: 'playerusername,casino,date1,currencycode,clienttype,clientplatform,viplevel,dplatform,gamename,gametype,gtype,gamegroup,gameshortname,gameprovider,gametechnology,gamesuite'
      })
    }
  ];

  // 4. SUBMISSION ENGINE
  function submit(report, delay) {
    setTimeout(() => {
      console.log('Exporting ' + report.name);
      
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = 'https://admin-cur.techonlinecorp.com/reportviewer/api/report/execute/export';
      form.target = '_blank'; // Trigger download
      form.style.display = 'none';

      const filters = report.getFilters(start, end);
      
      const payload = {
        reportId: report.reportId,
        configurationCode: report.code,
        format: 'csv',
        apikey: '',
        filters: JSON.stringify(filters),
        outputs: report.outputs,
        jsonOptions: '{"includeLegend": "none"}'
      };

      for (const k in payload) {
        const i = document.createElement('input');
        i.type = 'hidden';
        i.name = k;
        i.value = payload[k];
        form.appendChild(i);
      }

      document.body.appendChild(form);
      form.submit();
      
      // Notify user visually
      const notif = document.createElement('div');
      notif.style.cssText = 'position:fixed;top:10px;right:10px;background:#10b981;color:white;padding:10px;border-radius:5px;z-index:9999;font-family:sans-serif';
      notif.textContent = 'Downloading ' + report.name + ' (' + label + ')';
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 4000);

      setTimeout(() => form.remove(), 1000);
    }, delay);
  }

  // 5. EXECUTE
  alert('Starting Auto-Export for ' + label + '. Please allow multiple downloads if prompted.');
  submit(reports[0], 0);
  submit(reports[1], 2500); // 2.5s delay
})();
        `;
        return 'javascript:' + encodeURIComponent(script.replace(/\s+/g, ' '));
      };

      // --- NORTHSTAR LOGIC GENERATOR ---
      const generateNorthstarScript = () => {
        const script = `
(function() {
  console.log("Searching for Download button...");
  
  // Strategy: Find a span with 'Download' and click its parent button
  const spans = document.getElementsByTagName('span');
  let found = false;
  
  for(let i=0; i < spans.length; i++) {
    if(spans[i].innerText && spans[i].innerText.trim() === 'Download') {
       const btn = spans[i].closest('button');
       if(btn) {
         btn.click();
         found = true;
         
         const notif = document.createElement('div');
         notif.style.cssText = 'position:fixed;top:10px;right:10px;background:#3b82f6;color:white;padding:15px;border-radius:5px;z-index:9999;font-family:sans-serif;box-shadow:0 4px 12px rgba(0,0,0,0.3);';
         notif.textContent = 'Northstar Games Export Triggered!';
         document.body.appendChild(notif);
         setTimeout(() => notif.remove(), 3000);
         
         break;
       }
    }
  }
  
  if(!found) {
    alert('Could not find the "Download" button. Please ensure you are on the "Import / Export games" page.');
  }
})();
        `;
        return 'javascript:' + encodeURIComponent(script.replace(/\s+/g, ' '));
      };


      // --- APP COMPONENT ---

      const App = () => {
        const [system, setSystem] = useState('TECHONLINE');
        const [config, setConfig] = useState({
          instances: ['4280', '4690'],
          timeZone: 'Africa/Abidjan'
        });

        const techOnlineHref = generateTechOnlineScript(config);
        const northstarHref = generateNorthstarScript();

        return (
          <div className="min-h-screen flex flex-col items-center p-8 font-sans">
            
            <header className="mb-12 text-center space-y-2">
              <div className="inline-flex items-center justify-center p-3 rounded-2xl bg-indigo-500/10 mb-4 border border-indigo-500/20">
                <LayoutGrid className="text-indigo-400" size={32} />
              </div>
              <h1 className="text-4xl font-bold tracking-tight">
                <span className="text-white">Admin</span> <span className="gradient-text">Automation Hub</span>
              </h1>
              <p className="text-slate-400">Generate tools to automate your daily reporting workflows</p>
            </header>

            {/* System Selector */}
            <div className="bg-slate-800/50 p-1 rounded-xl flex gap-1 mb-8 border border-slate-700">
              <button 
                onClick={() => setSystem('TECHONLINE')}
                className={`px-6 py-2.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${system === 'TECHONLINE' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
              >
                <Globe size={16} /> TechOnline
              </button>
              <button 
                onClick={() => setSystem('NORTHSTAR')}
                className={`px-6 py-2.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${system === 'NORTHSTAR' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
              >
                <MousePointerClick size={16} /> Northstar Bets
              </button>
            </div>

            {/* Main Card */}
            <div className="w-full max-w-2xl">
              
              {system === 'TECHONLINE' && (
                <div className="glass-panel p-8 rounded-2xl animate-in fade-in slide-in-from-bottom-4 duration-500">
                  <div className="flex items-center justify-between mb-6">
                    <div>
                       <h2 className="text-xl font-bold text-white flex items-center gap-2">
                         <Download className="text-indigo-400" size={24} /> 
                         TechOnline Exporter
                       </h2>
                       <p className="text-sm text-slate-400 mt-1">Downloads Bonus & Game Statistics</p>
                    </div>
                    <div className="text-xs font-mono bg-indigo-900/30 text-indigo-300 px-3 py-1 rounded-full border border-indigo-500/30">
                      Auto-Date Logic (Mon/Daily)
                    </div>
                  </div>

                  <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50 mb-8 space-y-4">
                     <div>
                       <label className="text-xs text-slate-500 uppercase font-semibold tracking-wider">Target Instances</label>
                       <input 
                          type="text" 
                          value={config.instances.join(', ')}
                          onChange={(e) => setConfig({...config, instances: e.target.value.split(',').map(s => s.trim())})}
                          className="w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm text-slate-200 mt-1 focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                       />
                     </div>
                     <div>
                       <label className="text-xs text-slate-500 uppercase font-semibold tracking-wider">Time Zone</label>
                       <input 
                          type="text" 
                          value={config.timeZone}
                          onChange={(e) => setConfig({...config, timeZone: e.target.value})}
                          className="w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm text-slate-200 mt-1 focus:ring-2 focus:ring-indigo-500 outline-none transition-all"
                       />
                     </div>
                  </div>

                  <div className="border-t border-slate-700/50 pt-6">
                    <p className="text-sm text-slate-300 mb-4 flex items-start gap-2">
                       <ArrowRight className="text-indigo-400 mt-0.5" size={16} />
                       <span><strong>Drag</strong> the button below to your bookmarks bar.</span>
                    </p>
                    
                    <div className="flex justify-center">
                      <a 
                        href={techOnlineHref}
                        className="bookmark-btn group relative inline-flex items-center gap-3 bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-4 rounded-xl font-bold shadow-xl shadow-indigo-900/20 transition-all transform hover:-translate-y-1"
                        onClick={(e) => e.preventDefault()}
                        title="Drag me to bookmarks!"
                      >
                         <ShieldCheck size={20} />
                         TechOnline Export
                         <span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                            Drag Me
                         </span>
                      </a>
                    </div>
                    
                    <div className="mt-6 text-center">
                       <p className="text-xs text-slate-500">
                          Use on <span className="text-slate-400 font-mono">admin-cur.techonlinecorp.com</span>
                       </p>
                    </div>
                  </div>
                </div>
              )}

              {system === 'NORTHSTAR' && (
                <div className="glass-panel p-8 rounded-2xl animate-in fade-in slide-in-from-bottom-4 duration-500">
                  <div className="flex items-center justify-between mb-6">
                    <div>
                       <h2 className="text-xl font-bold text-white flex items-center gap-2">
                         <MousePointerClick className="text-blue-400" size={24} /> 
                         Northstar Auto-Clicker
                       </h2>
                       <p className="text-sm text-slate-400 mt-1">Automates "Download Game List"</p>
                    </div>
                    <div className="text-xs font-mono bg-blue-900/30 text-blue-300 px-3 py-1 rounded-full border border-blue-500/30">
                      UI Automation
                    </div>
                  </div>

                  <div className="bg-slate-900/50 p-6 rounded-xl border border-slate-700/50 mb-8">
                     <p className="text-sm text-slate-300 leading-relaxed">
                        This tool automates the click on the <strong>"Download"</strong> button in the Northstar Import/Export panel. 
                        It works for both the <code>.ca</code> and <code>.com</code> admin portals.
                     </p>
                  </div>

                  <div className="border-t border-slate-700/50 pt-6">
                    <p className="text-sm text-slate-300 mb-4 flex items-start gap-2">
                       <ArrowRight className="text-blue-400 mt-0.5" size={16} />
                       <span><strong>Drag</strong> the button below to your bookmarks bar.</span>
                    </p>
                    
                    <div className="flex justify-center">
                      <a 
                        href={northstarHref}
                        className="bookmark-btn group relative inline-flex items-center gap-3 bg-blue-600 hover:bg-blue-500 text-white px-8 py-4 rounded-xl font-bold shadow-xl shadow-blue-900/20 transition-all transform hover:-translate-y-1"
                        onClick={(e) => e.preventDefault()}
                        title="Drag me to bookmarks!"
                      >
                         <ExternalLink size={20} />
                         Northstar Export
                         <span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity">
                            Drag Me
                         </span>
                      </a>
                    </div>

                    <div className="mt-6 text-center">
                       <p className="text-xs text-slate-500">
                          Use on <span className="text-slate-400 font-mono">portal-admin.northstarbets...</span>
                       </p>
                    </div>
                  </div>
                </div>
              )}

            </div>

          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
